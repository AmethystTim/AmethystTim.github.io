## 关系模型、关系模式、关系的区分

- 关系模型（关系模式的抽象——表的形式）
- 关系迷失（关系的抽象）
- 关系（关系模型的数据）

## 关系模型与关系运算概览

- 关系运算：**关系代数**（过程化）和**关系演算**（非过程化）
    - 关系演算：元组演算和域演算
    - 关系代数：过程化查询语言，包括运算的集合

> 元组演算示例：基于逻辑的运算，基于元组的运算<br>
> 域演算：基于逻辑的运算，基于示例的运算

### 关系

简而言之，一个关系就是一个Table，关系模型就是用于处理Table的

关系模型由三个部分组成

- 描述DB各种数据的基本结构形式
- 描述Table与Table之间所可能发生的各种操作，即关系运算
- 描述这些操作所应遵循的约束条件

> 第三条也被称为完整性条件

### 关系模型的三个要素

- 基本结构：关系/表
- 基本操作：关系运算
    - 基本的：并、差、广义积、选择、投影、更名
    - 扩展的：交、连接、除
- 完整性约束：实体完整性、参照完整性、用户自定义完整性

## 关系与关系模型

### 关系

- 为什么把表称为“关系”？
- 如何严格定义Table？

行被称为**元组**

首先定义列的取值范围为“**域**(Domain)”

- 一组值的集合，这组值有相同的数据类型
- 如整数的集合、字符串的集合、全体学生的集合
- 再如，由8位数字组成的数字串的集合，由0到100组成的整数集合
- 集合中的元素个数成为域的**基数(Cardinality)**

再定义“元组”以及**所有可能组成的元组**：**笛卡尔积**

一组域$D_1,D_2,\dots , D_n$的笛卡尔积为

$$D_1\times D_2\times \dots\times D_n = \{(d_1,d_2,\dots,d_n)|d_i\in D_i,i=1,\dots,n\}$$

关系可以用$R(A_1:D_1,A_2:D_2,\dots,A_n:D_n)$表示$R(A_1,A_2,\dots,A_n)$

> 其中R是关系的名字，$A_i$是属性，$D_i$是属性所对应的域，n是关系的度或者目<br>
> 比如`Course (C# char(3), Cname char(12), Chours integer, Credit float(1), T# char(3))`

### 关系的特性

1. 不同的列可能来自同一个域
2. 每一列中的分量来自同一个域，是同一类型的数据
3. 列位置互换性：区分依靠列名
4. 行位置互换性：区分哪一行是依靠某一或某几列的值
5. 关系是以内容（名字或值）来区分的，而不是属性在关系的位置来区分
6. 属性不可再分性：又被称为**关系第一范式**

> 理论上：任何两个元组不能完全相同；真实的Table可能有完全相同的两行

### 候选码（键）

关系中的一个属性组，其值能唯一标识一个元组，若从该属性组中去掉任何一个属性，它就不再具有这一个性质

> 关系`Stu(S#, Sname, Sage, Sclass)`中`S#`就是一个候选码，在学生关系中，仍和两个元组的S#是一定不同的
>
> 又比如选课关系`StuClass(S#, C#, Sname, Sage, Sclass)`中`(S#, C#)`联合起来就是一个候选码

- 在某些关系中，候选码可能不止一组，比如`Stu((S#, Sname, Sage, Sclass, Saddress)`， `S#`和`(Sname, Saddress)`都是候选码

### 主码/键

- 当有多个候选码时，可以选定一个作为主码

包含在任何一个候选码中的属性被称为**主属性**，其他属性被称为**非主属性**

在最极端情况下，关系所有属性组是这个关系候选码，称为**全码**

### 外码

关系R中的一个属性组，它不是R的候选码，但它与另一个关系S的候选码相对应，则称这个属性组为R的外码或外键。

### 关系模型中的完整性

#### 实体完整性

- 关系主码的属性值不能为空
- 空值：不知道或者无意义的值

空值的含义

- 在进行关系操作时，有时关系中的某属性值在当前是填不上的，比如档案中有“生日不详”、“下落不明”、“日程尚待公布”等，这时就需要空值来代表这种情况。关系模型中用‘?’表征
- 数据库中有了空值，会影响许多方面，如影响聚集函数运算的正确
性，不能参与算术、比较或逻辑运算等

#### 参照完整性

如果关系R1的外码Fk与关系R2的主码Pk相对应，则R1中的每一个元组的Fk值或者等于R2中某个元组的Pk值，或者为空值

> 换言之：如果关系R1的某个元组t1参照了关系R2的某个元组t2，则t2必须存在

#### 用户自定义完整性

用户针对具体的应用环境定义的完整性**约束条件**

> 如S#要求是10位整数，其中前四位为年度，当前年度与他们的差必须在4以内

## 关系代数

### 基本操作

- 基本的：并、差、广义积、选择、投影、更名
- 扩展的：交、连接、除

> 某些关系代数操作，如并、差、交等，需满足“并相容性”

#### 并相容性

- 参与运算的两个关系及其相关属性之间有一定的对应性
- 定义：关系R与关系S存在相容性，当且仅当：

1. 关系R和关系S的属性数目必须相同；
2. 对于任意i，关系R的第i个属性的域必须和关系S的第i个属性的域相同

假设：$R(A1, A2, … ,An) , S(B1, B2, …,Bm)$ R和S满足并相容性：n = m 并且 `Domain(Ai) = Domain(Bi)`

### 用关系代数表达检索请求的示例